# Elwood Configuration Example
# Copy this to config.yaml and customize

# Directory for persistent state (conversation history, etc.)
# Default: /var/lib/assistant
stateDir: /var/lib/assistant

# Directory containing SOUL.md, AGENTS.md, etc.
# Default: /var/lib/assistant/workspace
workspaceDir: /var/lib/assistant/workspace

# Telegram chat IDs allowed to interact with the bot
# Find your chat ID by messaging @userinfobot on Telegram
allowedChatIds:
  - 123456789

# Claude model to use
# Default: claude-sonnet-4-20250514
model: claude-sonnet-4-20250514

# Extended thinking level: off | low | medium | high
# Controls Claude's internal reasoning before responding.
#   off    - disabled (default)
#   low    - budget_tokens: 1024,  max_tokens: 4096
#   medium - budget_tokens: 4096,  max_tokens: 8192
#   high   - budget_tokens: 16384, max_tokens: 32768
thinking: off

# Maximum agent loop iterations per turn (prevents infinite tool-use loops)
# Default: 30
maxIterations: 30

# Context compaction settings
# When conversation history exceeds the token threshold, older messages
# are summarized using a fast model to stay within context limits.
compaction:
  tokenThreshold: 80000                       # default: 80000
  compactionModel: claude-3-5-haiku-20241022  # default: claude-3-5-haiku-20241022

# Tool permission settings
permissions:
  defaultPolicy: allow          # allow | ask | deny (default: allow)
  approvalTimeoutSeconds: 120   # seconds to wait for user approval (default: 120)
  toolPolicies:                 # per-tool overrides
    run_command: ask
  safeCommands:                 # shell commands that bypass approval
    - ls
    - cat
    - git status
    - git log
  dangerousPatterns:            # shell patterns that are always denied
    - "rm -rf"
    - "sudo"

# MCP (Model Context Protocol) server configurations
# Each key becomes the server name used to namespace its tools.
mcpServers:
  my-server:
    command: npx                    # command to run (required)
    args:                           # command arguments
      - "-y"
      - "@example/mcp-server"
    env:                            # environment variables
      API_KEY: "secret"
    startupDelay: 1000              # ms to wait after spawn (default: 0)

# Webhook server configuration
# Exposes HTTP endpoints that trigger agent conversations.
# Built-in endpoints (no auth required):
#   GET /health   - health check (returns {"status":"ok"})
#   GET /metrics  - Prometheus metrics endpoint
webhook:
  enabled: false                # default: false
  port: 8080                    # default: 8080
  globalSecret: "s3cret"        # required header X-Webhook-Secret (or set WEBHOOK_SECRET env var)
  endpoints:
    - name: deploy              # route: POST /webhook/deploy (required)
      secret: "per-hook-key"    # per-endpoint secret override
      promptTemplate: "Deploy event: {{.repo}} {{.branch}}"  # template with {{.field}} placeholders
      # promptFile: prompts/deploy.md  # alternative: read prompt from file in workspace
      # session: "123456789"    # session name for persistent conversation (default: null = isolated)
      deliver:                  # where to send responses (default: [{type: telegram}])
        - type: telegram        # broadcast to all allowedChatIds
        # - type: telegram
        #   session: "123456789"  # send to specific chat
        - type: log             # log only, no notification
      suppressIfContains: "no action needed"  # suppress notification if response contains this

# Environment variables (not set in this file):
#   TELEGRAM_BOT_TOKEN   - Telegram bot token (required)
#   ANTHROPIC_API_KEY    - Anthropic API key (required)
#   WEBHOOK_SECRET       - Webhook secret (optional, overrides globalSecret above)
