# Elwood Configuration Example
# Copy this to config.yaml and customize

# Directory for persistent state (conversation history, etc.)
# Default: /var/lib/assistant
stateDir: /var/lib/assistant

# Directory containing SOUL.md, AGENTS.md, etc.
# Default: /var/lib/assistant/workspace
workspaceDir: /var/lib/assistant/workspace

# Telegram chat IDs allowed to interact with the bot
# Find your chat ID by messaging @userinfobot on Telegram
allowedChatIds:
  - 123456789

# Claude model to use
# Default: claude-sonnet-4-20250514
model: claude-sonnet-4-20250514

# Extended thinking configuration
# Controls Claude's internal reasoning before responding.
# Default: off (omit or set to "off" to disable)
#
# Adaptive thinking (recommended for newer models):
#   thinking:
#     type: adaptive
#     effort: medium          # low | medium | high
#     # max_tokens by effort: low=4096, medium=16000, high=32768
#
# Fixed budget (for older models):
#   thinking:
#     type: fixed
#     budgetTokens: 4096      # explicit budget_tokens value
thinking: off

# Maximum agent loop iterations per turn (prevents infinite tool-use loops)
# Default: 30
maxIterations: 30

# Dynamic tool loading: false | true | {alwaysLoad: [...]}
# When enabled, only pre-loaded tools are sent in each API request.
# The model uses find_tools to search for and load additional tools on demand.
#   false/omitted  - disabled (all tool schemas sent in every request)
#   true           - enabled (only find_tools pre-loaded)
#   {alwaysLoad: [tool1, tool2]}  - enabled with specified tools always available
# dynamicToolLoading: false

# System prompt configuration
# A list of prompt inputs assembled into the system prompt.
# Default (when omitted): [{ type: workspaceFile, path: SOUL.md }]
#
# Supported input types:
#   - type: workspaceFile    # read file from workspaceDir
#     path: SOUL.md
#   - type: text             # inline text
#     content: "Additional context"
#
# systemPrompt:
#   - type: workspaceFile
#     path: SOUL.md
#   - type: text
#     content: "Additional instructions"

# Context compaction settings
# When conversation history exceeds the token threshold, older messages
# are summarized using a fast model to stay within context limits.
compaction:
  tokenThreshold: 50000                       # default: 50000
  compactionModel: claude-3-5-haiku-20241022  # default: claude-3-5-haiku-20241022

# Tool permission settings
permissions:
  defaultPolicy: allow          # allow | ask | deny (default: allow)
  approvalTimeoutSeconds: 120   # seconds to wait for user approval (default: 120)
  toolPolicies:                 # per-tool overrides
    run_command: ask
  dangerousPatterns:            # regex patterns — matched commands are denied
    - "\\brm\\b"               # block rm, but...
    - "\\bsudo\\b"
  safePatterns:                 # regex patterns — override dangerousPatterns
    - "^rm -i\\b"              # ...allow interactive rm

# MCP (Model Context Protocol) server configurations
# Each key becomes the server name used to namespace its tools.
mcpServers:
  my-server:
    command: npx                    # command to run (required)
    args:                           # command arguments
      - "-y"
      - "@example/mcp-server"
    env:                            # environment variables
      API_KEY: "secret"
    startupDelay: 1000              # ms to wait after spawn (default: 0)

# Webhook server configuration
# Exposes HTTP endpoints that trigger agent conversations.
# Built-in endpoints (no auth required):
#   GET /health   - health check (returns {"status":"ok"})
#   GET /metrics  - Prometheus metrics endpoint
webhook:
  enabled: false                # default: false
  port: 8080                    # default: 8080
  globalSecret: "s3cret"        # required header X-Webhook-Secret (or set WEBHOOK_SECRET env var)
  endpoints:
    - name: deploy              # route: POST /webhook/deploy (required)
      secret: "per-hook-key"    # per-endpoint secret override
      prompt:                   # prompt inputs (assembled and rendered with {{.field}} placeholders)
        - type: text
          content: "Deploy event: {{.repo}} {{.branch}}"
      # session: "123456789"    # session name for persistent conversation (default: null = isolated)
      # model: claude-haiku-4-20250414    # per-endpoint model override (default: use global model)
      # thinking:                         # per-endpoint thinking override (default: use global thinking)
      #   type: adaptive
      #   effort: low
      deliver:                  # where to send responses (default: [{type: telegram}])
        - type: telegram        # broadcast to all allowedChatIds
        # - type: telegram
        #   session: "123456789"  # send to specific chat
        - type: log             # log only, no notification
      suppressIfContains: "no action needed"  # suppress notification if response contains this

# Environment variables (not set in this file):
#   TELEGRAM_BOT_TOKEN   - Telegram bot token (required)
#   ANTHROPIC_API_KEY    - Anthropic API key (required)
#   WEBHOOK_SECRET       - Webhook secret (optional, overrides globalSecret above)
